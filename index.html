<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astuto Erizo - Psico-Zen Irreverente</title>
    <link rel="icon" type="image/png" href="[Ruta_a_tu_Icono.png]">
    
    <style>
        /* CSS BSICO PARA UNA BUENA EXPERIENCIA MVIL */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #e8f5e9; /* Un verde muy suave para la calma zen */
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background-color: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        #erizo-img {
            max-width: 120px;
            margin-bottom: 15px;
        }

        h1 {
            color: #4caf50; /* Verde principal */
            font-size: 1.8em;
        }

        /* rea de Consulta */
        #consulta-area {
            margin-bottom: 20px;
        }

        #user-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #a5d6a7;
            border-radius: 8px;
            font-size: 1em;
            resize: vertical;
            box-sizing: border-box;
        }

        #consultar-btn {
            width: 100%;
            padding: 15px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #consultar-btn:hover {
            background-color: #388e3c;
        }

        /* rea de Respuesta */
        #respuesta-area {
            border-top: 2px dashed #a5d6a7;
            padding-top: 20px;
        }

        .erizo-mensaje {
            background-color: #f1f8e9; /* Fondo suave para la respuesta */
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #4caf50;
            line-height: 1.6;
        }
        
        .cargando {
             text-align: center;
             color: #777;
             font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        
       <header>
          <img id="erizo-img" src="erizo solo.png" alt="El Astuto Erizo">
          <h1>El Astuto Erizo te Escucha</h1>
        </header>
        
        <section id="consulta-area">
            <textarea id="user-input" placeholder="Cu茅ntale al Erizo qu茅 te pica, qu茅 te molesta o d贸nde te has enredado..." rows="4"></textarea>
            <button id="consultar-btn">Consultar al Erizo </button>
        </section>
        
        <section id="respuesta-area">
            <div id="erizo-output" class="erizo-mensaje">
                **Astuto Erizo:** "隆Bah! El primer paso es dejar de pincharte a ti mismo. 驴Qu茅 mosca te ha picado hoy? Dime."
            </div>
        </section>
        
    </div>

   <script type="module">
    //  1. URL DE TU FUNCIN SERVERLESS DE VERCEL
    const ERIZO_API_URL = "https://ast-erizo-psicologo.vercel.app/api/erizo"; 
    
    // 2. Historial de conversaci贸n para la funci贸n "Y dale"
    // Lo usaremos para enviarle a Vercel el contexto completo
    let conversationHistory = []; 

    // --- Funci贸n Principal de Consulta ---
    async function getErizoResponse(userInput) {
        
        // 3. A帽adir la nueva consulta del usuario al historial
        conversationHistory.push({ role: "user", content: userInput });

        const requestBody = {
            conversationHistory: conversationHistory
        };

        try {
            // 4. Llamada segura al backend de Vercel (que a su vez llama a OpenAI)
            const response = await fetch(ERIZO_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                // Manejo de errores de la API (ej. error 500 del backend)
                throw new Error('Error de conexi贸n con el Erizo.');
            }
            
            const data = await response.json();
            const erizoText = data.erizoResponse;
            
            // 5. A帽adir la respuesta del modelo al historial
            conversationHistory.push({ role: "assistant", content: erizoText });

            // 6. Limpiar el historial si es muy largo
            if (conversationHistory.length > 10) {
                // Mantenemos solo las 煤ltimas 10 interacciones (5 pares)
                conversationHistory = conversationHistory.slice(-10); 
            }

            return erizoText;

        } catch (error) {
            // Si hay error, quitamos la 煤ltima entrada del usuario del historial para no confundir a la IA en el siguiente intento
            conversationHistory.pop(); 
            throw new Error(error.message);
        }
    }


    // --- L贸gica de Interfaz (EventListener) ---
    document.getElementById('consultar-btn').addEventListener('click', async () => {
        const userInput = document.getElementById('user-input').value.trim();
        const outputDiv = document.getElementById('erizo-output');
        const button = document.getElementById('consultar-btn');

        if (userInput === "") {
            outputDiv.innerHTML = '<div class="erizo-mensaje"><strong>Astuto Erizo:</strong> 隆Amigo! No me hagas perder el tiempo. Escribe algo.</div>';
            return;
        }

        // 1. Deshabilitar bot贸n y mostrar carga
        button.disabled = true;
        button.textContent = 'El Erizo est谩 rumiando...';
        outputDiv.innerHTML = '<p class="cargando">El Erizo est谩 buscando un gusano para inspirarse...</p>';
        
        // 2. Llamada a la IA
        try {
            const erizoResponse = await getErizoResponse(userInput);
            
            outputDiv.innerHTML = `<div class="erizo-mensaje">${erizoResponse}</div>`;
            document.getElementById('user-input').value = ''; // Limpiar campo
        } catch (error) {
            outputDiv.innerHTML = `<div class="erizo-mensaje" style="color: red;"><strong>Astuto Erizo:</strong> 隆Vaya! Se me han enredado las p煤as. Algo ha fallado: ${error.message}</div>`;
        } finally {
            // 3. Restaurar bot贸n
            button.disabled = false;
            button.textContent = 'Consultar al Erizo ';
        }
    });

</script>
</body>
</html>
